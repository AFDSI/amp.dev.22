<!--
source
  https://blog.amp.dev/2022/02/28/web-story-forms-unlock-more-ways-to-engage-your-audience/
compare to template
servers
  https://amp.dev/search/latest-query
  https://amp.dev/documentation/examples/api/echo
  https://amp.dev/search/autosuggest
  https://amp.dev/search/highlights?locale=en
  https://amp.dev/search/highlights?locale=en' : 'https://amp.dev/search/do?q=' + encodeURIComponent(query) + '&amp;locale=en

-->
<amp-state id="query" src="https://amp.dev/search/latest-query" class=""></amp-state>
<amp-state id="clear" data-amp-bind-src="clear ? 'https://amp.dev/search/clear-latest-query' : ''" class=""></amp-state>

<amp-lightbox id="searchLightbox" class="ap-o-search" layout="nodisplay" on="lightboxOpen:searchInput.focus,AMP.setState({clear: false});
                  lightboxClose:searchTriggerOpen.focus" scrollable hidden="hidden">
  <div class="ap-o-search-escaper" role="button" tabindex="0" on="tap:searchLightbox.close"></div>
  <div class="ap-o-search-container">

    <div class="ap-m-search-trigger ap-m-search-trigger-close" on="tap:searchLightbox.close,AMP.setState({clear: true, query: null})" role="button" tabindex="0">
      <div class="ap-a-ico ap-m-search-trigger-icon">
        <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#close"></use></svg>
      </div>
    </div>

    <div class="ap-o-search-field">
      <form action-xhr="https://amp.dev/documentation/examples/api/echo" class="ap-o-search-form" id="searchForm" method="POST" on="submit:AMP.setState({ query: throttledValue }),searchResult.focus,searchList.changeToLayoutContainer" target="_top">
        <amp-autocomplete class="ap-o-search-autocomplete " filter="substring" min-characters="1" on="select:AMP.setState({ query: event.value })" submit-on-enter="false" src="https://amp.dev/search/autosuggest">
          <div class="ap-a-ico ap-o-search-input-icon">
            <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#magnifier"></use></svg>
          </div>
          <input id="searchInput" class="ap-o-search-input" name="q" placeholder="What are you looking for?" on="input-throttled:AMP.setState({ throttledValue: event.value })" data-amp-bind-value="query == null ? '' : query" required>
          <button class="ap-o-search-submit" type="submit" name="search-submit" disabled data-amp-bind-disabled="!throttledValue">Search</button>
        </amp-autocomplete>
      </form>

      <div class="ap-o-search-result" id="searchResult" tabindex="-1">
        <amp-state id="search" src="https://amp.dev/search/highlights?locale=en" data-amp-bind-src="query == null || clear ? 'https://amp.dev/search/highlights?locale=en' : 'https://amp.dev/search/do?q=' + encodeURIComponent(query) + '&amp;locale=en'" class=""></amp-state>
        <amp-list id="searchList" src="https://amp.dev/search/highlights?locale=en" data-amp-bind-src="query == null || clear ? 'https://amp.dev/search/highlights?locale=en' : 'https://amp.dev/search/do?q=' + encodeURIComponent(query) + '&amp;locale=en'" binding="no" items="." height="80vh" layout="fixed-height" load-more="auto" load-more-bookmark="nextUrl" reset-on-refresh single-item class="" style="height:80vh">

          <template type="amp-mustache" id="searchResultTemplate">
            <div class="ap-o-search-result-list">
              {{^prevUrl}}
              {{#result.components.length}}
              <h4 class="ap-o-search-result-category">{{#initial}}Important Components{{/initial}}{{^initial}}Components{{/initial}}</h4>
              {{/result.components.length}}
              {{/prevUrl}}
              {{#result.components}}
              <div class="ap-o-search-result-item ap-o-search-result-item-highlight">
                <a class="ap-o-search-result-link" href="{{url}}">
                  <h4 class="ap-o-search-result-title">{{#initial}}&lt;{{title}}&gt;{{/initial}}{{^initial}}{{title}}{{/initial}}</h4>
                  <p class="ap-o-search-result-description">{{description}}</p>
                </a>
                {{#exampleUrl}}
                <div class="ap-o-search-result-linklist">
                  <a class="ap-o-search-result-linklist-item ap-o-search-result-linklist-item-example ap-m-lnk" href="{{exampleUrl}}">
                    <div class="ap-a-ico ap-m-lnk-icon">
                      <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#internal"></use></svg>
                    </div>
                    <span class="ap-m-lnk-text">Open example</span>
                  </a>
                  {{#playgroundUrl}}
                  <a class="ap-o-search-result-linklist-item ap-o-search-result-linklist-item-playground ap-m-lnk" href="{{playgroundUrl}}" target="_blank">
                    <div class="ap-a-ico ap-m-lnk-icon">
                      <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#internal"></use></svg>
                    </div>
                    <span class="ap-m-lnk-text">Open in playground</span>
                  </a>
                  {{/playgroundUrl}}
                </div>
                {{/exampleUrl}}
              </div>
              {{/result.components}}

              {{^prevUrl}}
              {{#result.pages.length}}
              <h4 class="ap-o-search-result-category">{{#initial}}Popular Articles{{/initial}}{{^initial}}Results{{/initial}}</h4>
              {{/result.pages.length}}
              {{/prevUrl}}
              {{#result.pages}}
              <div class="ap-o-search-result-item">
                <a class="ap-o-search-result-link" href="{{url}}">
                  <h4 class="ap-o-search-result-title">{{title}}</h4>
                  <p class="ap-o-search-result-description">{{description}}</p>
                </a>
              </div>
              {{/result.pages}}

              {{#result.isTruncated}}
              <div class="ap-o-search-result-hint">
                Although there are {{result.totalResults}} hits in total we cannot show more than 100.
              </div>
              {{/result.isTruncated}}
            </div>
          </template>

          <amp-list-load-more load-more-button class="">
            <div class="ap-o-search-result-load-button" overflow>
              <button class="ap-a-btn">Load more</button>
            </div>
          </amp-list-load-more>

          <amp-list-load-more class="ap-o-search-result-hint" load-more-failed>
            Something went wrong while trying to load more search results.<br>
            We apologize for the inconvenience caused.<br>
            Please try again later.
          </amp-list-load-more>

          <div class="ap-o-search-result-error" fallback>
            <h2 class="ap-o-search-result-error-smiley">;(</h2>
            <h3 class="ap-o-search-result-error-headline">Something went wrong…</h3>
            <p class="ap-o-search-result-error-copy">
              …while trying to load the search results.<br>
              We apologize for the inconvenience caused.<br>
              Please try again later.
            </p>
          </div>
        </amp-list>

        <div class="ap-o-search-result-error" data-amp-bind-hidden="search.initial == true || search.result.totalResults != 0" hidden>
          <h2 class="ap-o-search-result-error-shruggie">¯\_(ツ)_/¯</h2>
          <h3 class="ap-o-search-result-error-headline">No results found.</h3>
          <p class="ap-o-search-result-error-copy">We could not find any results matching your search query.</p>
        </div>

      </div>
    </div>
  </div>
</amp-lightbox>	
